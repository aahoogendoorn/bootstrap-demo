<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:a4j="http://richfaces.org/a4j"
                xmlns:composite="http://java.sun.com/jsf/composite"
                xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://java.sun.com/jsf/composite/bootstrap/panels"
        >

    <!-- INTERFACE -->
    <composite:interface>
        <composite:attribute name="action" targets="okFunction"/>
        <composite:attribute name="header" type="java.lang.String" default="Mededeling"/>
        <composite:attribute name="style" type="java.lang.String" default="success"/>
        <composite:attribute name="glyph" type="java.lang.String" default="warning-sign"/>
        <composite:attribute name="text" type="java.lang.String"/>
        <composite:attribute name="okText" type="java.lang.String" default="OK"/>
        <composite:attribute name="okOnclick" type="java.lang.String" />

        <composite:attribute name="cancelText" type="java.lang.String" default="Annuleren"/>
        <composite:attribute name="render" type="java.lang.String" default="@form"/>
        <composite:attribute name="immediate" default="false"/>
        <composite:attribute name="lockscreen" type="java.lang.Boolean" default="false"/>
        <composite:attribute name="showCancel" type="java.lang.Boolean" default="false"/>
        <composite:attribute name="akkoordResult" type="java.lang.Boolean" default="true"/>
        <composite:attribute name="showClose" type="java.lang.Boolean" default="true"/>
    </composite:interface>

    <!-- IMPLEMENTATION -->
    <composite:implementation>
        <a4j:jsFunction name="akkoord_#{cc.clientId.replaceAll(':','')}"  id="okFunction" data="#{cc.attrs.akkoordResult}" onbeforedomupdate="return handleAkkoord_#{cc.clientId.replaceAll(':','')}(event.data);"
                        render="@none" immediate="#{cc.attrs.immediate}"
                        status="#{cc.attrs.lockscreen?'waitPanelStatus':''}" execute="@form"/>

        <h:outputScript>
            function handleAkkoord_#{cc.clientId.replaceAll(':','')}(akkoordResult){
                var valid = true;
                if (akkoordResult!=undefined){
                    valid = akkoordResult;
                }
                if (valid){
                    new Popup('#{cc.clientId}').hide();
                    refreshForm();
                } else {
                    $('#pageMessages').hide();
                }
                return valid;

            }

        </h:outputScript>

        <h:panelGroup layout="block" styleClass="modal fade" id="modal" tabindex="-1" role="dialog"
                      aria-labelledby="myModalLabel"
                      data-backdrop="static"
                      aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header modal-header-#{cc.attrs.style}">
                        <c:if test="#{cc.attrs.showClose}">
                            <span class="badge pull-right">
                                    <button type="button" class="btn btn-default btn-xs close" style="font-size:12px;" data-dismiss="modal" aria-hidden="true"><span
                                            class="glyphicon glyphicon-remove"/></button>
                            </span>
                        </c:if>
                        <h4><i class="fa fa-lg fa-#{cc.attrs.glyph}"/> #{cc.attrs.header}</h4>

                    </div>
                    <div class="modal-body">
                        <p:messages id="popupMessages"/>
                        <p>#{cc.attrs.text}</p>
                        <composite:insertChildren/>
                    </div>
                    <div class="modal-footer">

                        <div class="btn-toolbar">
                            <a role="button" class="btn btn-primary pull-left" id="#{cc.clientId}:okButton"
                                onclick="#{cc.attrs.okOnclick}akkoord_#{cc.clientId.replaceAll(':','')}()"
                                    ><span class="fa fa-lg fa-thumbs-o-up"/> #{cc.attrs.okText}</a>

                            <c:if test="#{cc.attrs.showCancel}">
                                <button class="btn btn-default pull-left"
                                        onclick="new Popup('#{cc.clientId}').hide();return false;">
                                    <span class="fa fa-lg fa-thumbs-o-down"/> #{cc.attrs.cancelText}
                                </button>
                            </c:if>
                        </div>
                    </div>
                </div>
            </div>
        </h:panelGroup>

        <a4j:jsFunction name="refreshModal#{cc.clientId.replaceAll(':', '')}" render="modal"/>
        <a4j:jsFunction name="refreshForm" render="@form"/>


    </composite:implementation>
</ui:composition>